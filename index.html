<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Guía SAGCOM 2 - Clima, Segmentos y Filtro Global</title>
<style>
  body::before {
    content: "";
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: url('https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/refs/heads/main/imagen.avif') no-repeat center center fixed;
    background-size: contain;
    filter: brightness(0.95);
    z-index: -3;
  }
  body::after {
    content: "";
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg,
      rgba(255,255,255,0.15) 10%,
      rgba(255,255,255,0.45) 30%,
      rgba(255,255,255,0.15) 70%,
      rgba(255,255,255,0.05) 90%);
    pointer-events: none;
    z-index: -2;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background-color: #fff;
    color: #222;
    position: relative; z-index: 0;
  }
  header {
    background: linear-gradient(145deg, #3a006f 0%, #6a0dad 60%, #fff 100%);
    color: white;
    font-weight: bold;
    font-size: 2rem;
    text-align: center;
    padding: 2rem 1rem 3rem 1rem;
    position: relative;
    letter-spacing: 1px;
    text-shadow: 3px 3px 8px #00000088;
  }
  header .autor-text {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    color: rgba(255,255,255,0.9);
    font-family: Georgia, serif;
    font-weight: 700;
    font-size: 1.1rem;
    user-select: none;
  }

  /* Clima panel ajustado para 3D y posición */
  #panelClima {
    position: fixed;
    bottom: 8%;
    left: 12px;
    background: rgba(255 255 255 / 0.95);
    border-radius: 20px;
    padding: 18px 24px;
    box-shadow:
      0 10px 15px rgba(0,0,0,0.2),
      0 4px 6px rgba(0,0,0,0.15);
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color: #3a006f;
    width: 270px;
    z-index: 100;
    transform-style: preserve-3d;
    perspective: 1000px;
    transition: transform 0.3s ease;
  }
  #panelClima:hover {
    transform: rotateY(15deg) rotateX(5deg) translateZ(30px);
    box-shadow:
      0 20px 30px rgba(0,0,0,0.3),
      0 10px 15px rgba(0,0,0,0.25);
  }
  #panelClima header {
    font-weight: 700;
    margin-bottom: 12px;
    font-size: 1.2rem;
    user-select:none;
    text-align: center;
  }
  #horaActual {
    font-size: 1.7rem;
    font-weight: 900;
    margin-bottom: 12px;
    letter-spacing: 1px;
    text-align: center;
  }
  #selectorRegion {
    width: 100%;
    margin-bottom: 16px;
    padding: 10px 18px;
    font-size: 1.1rem;
    border-radius: 14px;
    border: 2px solid #6a0dad;
    background: #fafafa;
    color: #3a006f;
    cursor: pointer;
    transition: box-shadow 0.3s ease;
  }
  #selectorRegion:focus {
    outline: none;
    box-shadow: 0 0 10px #6a0dadaa;
  }
  #climaInfo {
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #climaIcon {
    width: 52px;
    height: 52px;
    margin-right: 16px;
    filter: drop-shadow(0 0 5px #6a0dadbb);
    font-size: 2.8rem;
  }
  /* iconos animados */
  .icono-sun {
    animation: rotar 30s linear infinite;
  }
  .icono-cloud {
    animation: floatCloud 6s ease-in-out infinite;
  }
  .icono-rain {
    position: relative;
  }
  .icono-rain::after {
    content: "";
    position: absolute;
    left: 50%;
    width: 3px;
    height: 12px;
    background: #3a006fcc;
    border-radius: 50%;
    filter: blur(0.8px);
    animation: caerLluvia 1.2s linear infinite;
    animation-delay: 0s;
    top: 6px;
  }
  @keyframes rotar {
    0% { transform: rotate(0turn);}
    100% { transform: rotate(1turn);}
  }
  @keyframes floatCloud {
    0%, 100% { transform: translateY(0);}
    50% {transform: translateY(6px);}
  }
  @keyframes caerLluvia {
    0% {opacity: 1; transform: translateY(0);}
    100% {opacity: 0; transform: translateY(12px);}
  }
  /* Resto de estilos, perfiles y filtros */
  .perfil-filter {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
    margin: 1.5rem auto 1rem;
    max-width: 1100px;
  }
  .perfil-btn {
    background: linear-gradient(145deg, #6a0dad 0%, #3a006f 90%);
    border-radius: 24px;
    padding: 0.5rem 2rem;
    font-size: 1rem;
    font-weight: 700;
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 16px #3a006f77;
    transition: transform 0.28s ease, box-shadow 0.28s ease, background-color 0.3s ease;
    text-shadow: 1px 1px 8px #000000cc;
  }
  .perfil-btn:hover {
    box-shadow: 0 8px 24px #6a0daddd;
    transform: scale(1.1);
  }
  .perfil-btn.active {
    background-color: #52006b;
    box-shadow: 0 10px 28px #6a0dadcc;
    transform: scale(1.15);
  }
  #perfilSeleccionado {
    position: absolute;
    top: 140px;
    right: 12px;
    background: linear-gradient(145deg, #fdf6ff, #bb9edc);
    border-radius: 16px;
    padding: 8px 18px;
    font-size: 1.3rem;
    font-weight: 700;
    color: #6a0dad;
    text-align: center;
    box-shadow:
      0 8px 20px #7854ebaa,
      inset 0 -3px 10px #a095d1a1,
      inset 0 6px 8px #7b65c89a;
    user-select: none;
    width: max-content;
    max-width: 300px;
    z-index: 101;
  }
  .filters {
    max-width: 1100px;
    margin: 0.8rem auto 2rem auto;
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    align-items: center;
  }
  .filters input[type=search] {
    border: 2px solid #6a0dad;
    border-radius: 10px;
    padding: 0.5rem 1.5rem;
    font-size: 1rem;
    outline: none;
    box-shadow: 0 1px 7px #3a006f21;
    transition: 0.3s box-shadow ease;
    min-width: 350px;
  }
  .filters input[type=search]:focus {
    box-shadow: 0 0 13px #6a0dad77;
    border-color: #3a006f;
  }
  .filters button {
    font-weight: 700;
    padding: 0.45rem 1.2rem;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    cursor: pointer;
    color: white;
    box-shadow: 0 3px 20px #3a006fcc;
    transition: 0.3s background-color ease;
  }
  #btnReset {
    background-color: #a010d3;
  }
  #btnReset:hover {
    background-color: #68009a;
  }
  #btnWebSearch {
    background-color: #3d84e6;
  }
  #btnWebSearch:hover {
    background-color: #245ea7;
  }
  main {
    max-width: 1100px;
    margin: 0 auto 3rem;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 2px 20px #3a006f2e;
    padding: 1rem 2rem;
    display: flex;
    gap: 20px;
  }
  .subtitulo-container {
    border: 2px solid #6a0dad;
    border-radius: 16px;
    padding: 1rem 1.3rem;
    width: 300px;
    max-height: 600px;
    overflow-y: auto;
    background: #f2eeff;
    font-weight: 600;
    font-size: 1rem;
    color: #3a006f;
  }
  .subtitulo-container h3 {
    margin: 0 0 12px 0;
    font-weight: 800;
    color: #6a0dad;
    font-size: 1.3rem;
    border-bottom: 2px solid #6a0dad;
    padding-bottom: 6px;
    user-select: none;
  }
  .subtitulo-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .subtitulo-list li {
    padding: 0.55rem 0.8rem;
    margin-bottom: 5px;
    cursor: pointer;
    border-radius: 12px;
    transition: background-color 0.28s ease, color 0.28s ease;
  }
  .subtitulo-list li:hover, .subtitulo-list li.selected {
    background-color: #6a0dad;
    color: white;
    font-weight: 700;
  }
  .accion-container {
    flex-grow: 1;
    background: #fcfbfd;
    min-height: 180px;
    font-weight: 600;
    font-size: 1.12rem;
    color: #4a037d;
    border: 2px solid #6a0dad;
    border-radius: 16px;
    padding: 1rem 1.3rem;
    min-width: 460px;
    max-width: 600px;
    position: relative;
  }
  .accion-container h3 {
    font-weight: 900;
    font-size: 1.5rem;
    color: #6a0dad;
    margin-bottom: 12px;
  }
  .accion-text {
    white-space: pre-line;
    padding-left: 1rem;
  }
</style>
</head>
<body>
<header>
  Guía de pasos para SAGCOM 2
  <div class="autor-text" aria-label="Autor del documento">Creado por Héctor Alfaro M.</div>
</header>

<div id="panelClima" aria-label="Panel clima e información actual">
  <header>Clima y Hora</header>
  <div id="horaActual" aria-live="polite" aria-atomic="true">--:--:--</div>
  <select id="selectorRegion" aria-label="Seleccionar región de Chile para ver clima">
    <option value="" disabled selected>Seleccione región</option>
    <option value="Arica">Arica</option>
    <option value="Iquique">Iquique</option>
    <option value="Antofagasta">Antofagasta</option>
    <option value="Copiapo">Copiapó</option>
    <option value="La Serena">La Serena</option>
    <option value="Los Andes">Los Andes</option>
    <option value="Viña del Mar">Viña del Mar</option>
    <option value="Casa Matriz">Casa Matriz (Santiago)</option>
    <option value="Rancagua">Rancagua</option>
    <option value="Talca">Talca</option>
    <option value="Chillan">Chillán</option>
    <option value="Concepcion">Concepción</option>
    <option value="Lo Angeles">Lo Angeles</option>
    <option value="Temuco">Temuco</option>
    <option value="Valdivia">Valdivia</option>
    <option value="Osorno">Osorno</option>
    <option value="Puerto Montt">Puerto Montt</option>
    <option value="Chiloe">Chiloé</option>
    <option value="Coyhaique">Coyhaique</option>
    <option value="Punta Arenas">Punta Arenas</option>
  </select>
  <div id="climaInfo" aria-live="polite" role="region" style="margin-top:6px;">
    <div id="climaIcon" aria-label="Icono clima" role="img"></div>
    <div>
      <div id="climaTemp">-- °C</div>
      <div id="climaText">Elija una región para ver el clima</div>
    </div>
  </div>
</div>

<div class="perfil-filter" id="perfilFilter" aria-label="Filtros por perfiles"></div>
<div id="perfilSeleccionado" aria-live="polite">Seleccione un perfil</div>

<div class="filters">
  <input type="search" id="searchInput" placeholder="Filtrar toda la guía..." aria-label="Filtro global de búsqueda" />
  <button id="btnReset" title="Borrar filtros">Borrar filtros</button>
  <button id="btnWebSearch" title="Buscar en sitio web oficial">Buscar en spensiones.cl</button>
</div>

<main>
  <div class="subtitulo-container" aria-label="Tareas de perfil seleccionado">
    <h3>Tareas</h3>
    <nav class="subtitulo-list" id="subtituloList"><ul></ul></nav>
  </div>
  <div class="accion-container" aria-label="Acción a realizar para subtitulo">
    <h3>Acción a realizar</h3>
    <div class="accion-text" id="accionDisplay" tabindex="0" aria-live="polite"></div>
  </div>
</main>

<script>
  // Animaciones iconos clima
  const iconosAnim = {
    "☀️": "icono-sun",
    "⛅": "icono-cloud",
    "🌧️": "icono-rain",
    "🌫️": "icono-cloud",
    "☁️": "icono-cloud"
  };

  // Estados clima simulados
  const climaEstados = [
    { icon:"☀️", temp:23, texto:"Soleado", clase:"icono-sun" },
    { icon:"⛅", temp:18, texto:"Parcialmente nublado", clase:"icono-cloud" },
    { icon:"🌧️", temp:14, texto:"Lluvia ligera", clase:"icono-rain" },
    { icon:"🌫️", temp:12, texto:"Niebla", clase:"icono-cloud" },
    { icon:"☁️", temp:15, texto:"Nublado", clase:"icono-cloud" }
  ];

  // Actualiza hora cada segundo
  function actualizarHora() {
    const divHora = document.getElementById("horaActual");
    setInterval(() => {
      const ahora = new Date();
      const h = String(ahora.getHours()).padStart(2,"0");
      const m = String(ahora.getMinutes()).padStart(2,"0");
      const s = String(ahora.getSeconds()).padStart(2,"0");
      divHora.textContent = `${h}:${m}:${s}`;
    }, 1000);
  }

  // Actualiza el panel clima según región elegida
  function actualizarPanelClima(region){
    const climaIcon = document.getElementById("climaIcon");
    const climaTemp = document.getElementById("climaTemp");
    const climaText = document.getElementById("climaText");

    if(!region){
      climaIcon.className = "";
      climaIcon.textContent = "";
      climaTemp.textContent = "-- °C";
      climaText.textContent = "Elija una región para ver el clima";
      return;
    }
    const estado = climaEstados[Math.floor(Math.random()*climaEstados.length)];
    climaIcon.className = estado.clase;
    climaIcon.textContent = estado.icon;
    climaTemp.textContent = `${estado.temp} °C`;
    climaText.textContent = `${region}: ${estado.texto}`;
  }

  // Aquí empieza el código para segmentaciones, filtro, y acciones...
  document.addEventListener("DOMContentLoaded",()=>{
    actualizarHora();

    // Para ejemplo, estructura mínima
    const pasos = [
      { perfil: "Perfil A", subtitulo: "Inicio", accion: "Realiza el paso inicial para el Perfil A.", segmento: "Segmento 1", inicial: "A" },
      { perfil: "Perfil A", subtitulo: "Verificación", accion: "Confirma datos y validaciones.", segmento: "Segmento 1", inicial: "A" },
      { perfil: "Perfil B", subtitulo: "Inicio", accion: "Realiza el paso inicial para el Perfil B.", segmento: "Segmento 2", inicial: "B" },
      { perfil: "Perfil C", subtitulo: "Análisis", accion: "Ejecuta el análisis correspondiente.", segmento: "Segmento 3", inicial: "C" }
    ];

    // Variables para estado
    let perfilActivo = null;
    let subtituloActivo = null;

    // Carga filtros de perfiles en la barra
    const perfilFilter = document.getElementById("perfilFilter");
    function cargarFiltros() {
      const perfilesUnicos = [...new Set(pasos.map(p => p.perfil))];
      perfilFilter.innerHTML = "";
      perfilesUnicos.forEach(perfil => {
        const btn = document.createElement("button");
        btn.textContent = perfil;
        btn.classList.add("perfil-btn");
        btn.setAttribute("aria-pressed", "false");
        btn.addEventListener("click", () => {
          perfilActivo = perfil;
          cargarSubtitulos();
          actualizarPerfilSeleccionado();
          limpiarSeleccion();
        });
        perfilFilter.appendChild(btn);
      });
    }

    // Actualiza texto de perfil seleccionado
    const perfilSeleccionado = document.getElementById("perfilSeleccionado");
    function actualizarPerfilSeleccionado() {
      perfilSeleccionado.textContent = perfilActivo ? `Perfil: ${perfilActivo}` : "Seleccione un perfil";
      [...perfilFilter.children].forEach(btn => {
        btn.classList.toggle("active", btn.textContent === perfilActivo);
        btn.setAttribute("aria-pressed", btn.textContent === perfilActivo ? "true" : "false");
      });
    }

    // Carga subtitulos para perfil activo
    const subtituloList = document.getElementById("subtituloList").querySelector("ul");
    function cargarSubtitulos() {
      subtituloList.innerHTML = "";
      if (!perfilActivo) return;
      const subtitulos = pasos.filter(p => p.perfil === perfilActivo);
      subtitulos.forEach(sub => {
        const li = document.createElement("li");
        li.textContent = `${sub.inicial} - ${sub.subtitulo}`;
        li.tabIndex = 0;
        li.addEventListener("click", () => {
          subtituloActivo = sub;
          mostrarAccion();
          destacarSeleccion(li);
        });
        li.addEventListener("keypress", e => {
          if (e.key === "Enter" || e.key === " ") {
            subtituloActivo = sub;
            mostrarAccion();
            destacarSeleccion(li);
          }
        });
        subtituloList.appendChild(li);
      });
    }

    // Destaca selección en lista
    function destacarSeleccion(elemento) {
      [...subtituloList.children].forEach(li => li.classList.remove("selected"));
      elemento.classList.add("selected");
    }

    // Muestra acción del subtitulo seleccionado
    function mostrarAccion() {
      const accionDisplay = document.getElementById("accionDisplay");
      accionDisplay.textContent = subtituloActivo ? subtituloActivo.accion : "";
      accionDisplay.focus();
    }

    // Limpia selección y acción
    function limpiarSeleccion() {
      subtituloActivo = null;
      const accionDisplay = document.getElementById("accionDisplay");
      accionDisplay.textContent = "";
      [...subtituloList.children].forEach(li => li.classList.remove("selected"));
    }

    // Filtrado global con input y reset
    const searchInput = document.getElementById("searchInput");
    const btnReset = document.getElementById("btnReset");
    searchInput.addEventListener("input", () => {
      const query = searchInput.value.trim().toLowerCase();
      if (!perfilActivo) return;
      subtituloList.innerHTML = "";
      pasos.filter(p => p.perfil === perfilActivo && (p.subtitulo.toLowerCase().includes(query) || p.accion.toLowerCase().includes(query)))
        .forEach(sub => {
          const li = document.createElement("li");
          li.textContent = `${sub.inicial} - ${sub.subtitulo}`;
          li.tabIndex = 0;
          li.addEventListener("click", () => {
            subtituloActivo = sub;
            mostrarAccion();
            destacarSeleccion(li);
          });
          li.addEventListener("keypress", e => {
            if (e.key === "Enter" || e.key === " ") {
              subtituloActivo = sub;
              mostrarAccion();
              destacarSeleccion(li);
            }
          });
          subtituloList.appendChild(li);
        });
      limpiarSeleccion();
    });
    btnReset.addEventListener("click", () => {
      searchInput.value = "";
      limpiarSeleccion();
      cargarSubtitulos();
    });

    // Botón para búsqueda en web oficial
    const btnWebSearch = document.getElementById("btnWebSearch");
    btnWebSearch.addEventListener("click", () => {
      if (!perfilActivo) return;
      const url = `https://suspensiones.cl/buscar?perfil=${encodeURIComponent(perfilActivo)}`;
      window.open(url, "_blank");
    });

    // Inicialización
    cargarFiltros();
  });
</script>
</body>
</html>
