<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Guía SAGCOM 2 - Clima, Noticias y Workflow</title>
<style>
  body::before {
    content: "";
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: url('https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/refs/heads/main/imagen.avif') no-repeat center center fixed;
    background-size: contain;
    filter: brightness(0.95);
    z-index: -3;
  }
  body::after {
    content: "";
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg,
      rgba(255,255,255,0.15) 10%,
      rgba(255,255,255,0.45) 30%,
      rgba(255,255,255,0.15) 70%,
      rgba(255,255,255,0.05) 90%);
    pointer-events: none;
    z-index: -2;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background-color: #fff;
    color: #222;
    position: relative; z-index: 0;
  }
  header {
    background: linear-gradient(145deg, #3a006f 0%, #6a0dad 60%, #fff 100%);
    color: white;
    font-weight: bold;
    font-size: 2rem;
    text-align: center;
    padding: 2rem 1rem 3rem 1rem;
    position: relative;
    letter-spacing: 1px;
    text-shadow: 3px 3px 8px #00000088;
  }
  header .autor-text {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    color: rgba(255,255,255,0.9);
    font-family: Georgia, serif;
    font-weight: 700;
    font-size: 1.1rem;
    user-select: none;
  }

  #panelClima {
    position: fixed;
    bottom: 8%;
    left: 12px;
    background: rgba(255 255 255 / 0.9);
    border-radius: 20px;
    padding: 14px 22px;
    box-shadow: 0 3px 18px #6a0dadaa;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    color: #3a006f;
    width: 270px;
    z-index: 100;
  }
  #panelClima header {
    font-weight: 700;
    margin-bottom: 8px;
    font-size: 1.15rem;
    user-select:none;
  }
  #horaActual {
    font-size: 1.5rem;
    font-weight: 900;
    margin-bottom: 10px;
    letter-spacing: 1px;
  }
  #selectorRegion {
    width: 100%;
    margin-bottom: 12px;
    padding: 8px 15px;
    font-size: 1rem;
    border-radius: 10px;
    border: 2px solid #6a0dad;
    background: #fafafa;
    color: #3a006f;
    cursor: pointer;
  }
  #climaInfo {
    display: flex;
    align-items: center;
  }
  #climaIcon {
    width: 52px;
    height: 52px;
    margin-right: 16px;
    filter: drop-shadow(0 0 5px #6a0dadbb);
  }

  .perfil-filter {
    display: flex;
    justify-content: center;
    gap: 1rem;
    flex-wrap: wrap;
    margin: 1.5rem auto 1rem;
    max-width: 1100px;
  }
  .perfil-btn {
    background: linear-gradient(145deg, #6a0dad 0%, #3a006f 90%);
    border-radius: 24px;
    padding: 0.5rem 2rem;
    font-size: 1rem;
    font-weight: 700;
    color: white;
    border: none;
    cursor: pointer;
    box-shadow: 0 4px 16px #3a006f77;
    transition: transform 0.28s ease, box-shadow 0.28s ease, background-color 0.3s ease;
    text-shadow: 1px 1px 8px #000000cc;
  }
  .perfil-btn:hover {
    box-shadow: 0 8px 24px #6a0daddd;
    transform: scale(1.1);
  }
  .perfil-btn.active {
    background-color: #52006b;
    box-shadow: 0 10px 28px #6a0dadcc;
    transform: scale(1.15);
  }

  #perfilSeleccionado {
    position: absolute;
    top: 140px; /* bajado para no tapar autor */
    right: 12px;
    background: linear-gradient(145deg, #fdf6ff, #bb9edc);
    border-radius: 16px;
    padding: 8px 18px;
    font-size: 1.3rem;
    font-weight: 700;
    color: #6a0dad;
    text-align: center;
    box-shadow:
      0 8px 20px #7854ebaa,
      inset 0 -3px 10px #a095d1a1,
      inset 0 6px 8px #7b65c89a;
    user-select: none;
    width: max-content;
    max-width: 300px;
    z-index: 101;
  }

  .filters {
    max-width: 1100px;
    margin: 0.8rem auto 2rem auto;
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    align-items: center;
  }
  .filters input[type=search] {
    border: 2px solid #6a0dad;
    border-radius: 10px;
    padding: 0.5rem 1.5rem;
    font-size: 1rem;
    outline: none;
    box-shadow: 0 1px 7px #3a006f21;
    transition: 0.3s box-shadow ease;
    min-width: 180px;
  }
  .filters input[type=search]:focus {
    box-shadow: 0 0 13px #6a0dad77;
    border-color: #3a006f;
  }
  .filters button {
    font-weight: 700;
    padding: 0.45rem 1.2rem;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    cursor: pointer;
    color: white;
    box-shadow: 0 3px 20px #3a006fcc;
    transition: 0.3s background-color ease;
  }
  #btnReset {
    background-color: #a010d3;
  }
  #btnReset:hover {
    background-color: #68009a;
  }
  #btnWebSearch {
    background-color: #3d84e6;
  }
  #btnWebSearch:hover {
    background-color: #245ea7;
  }

  main {
    max-width: 1100px;
    margin: 0 auto 3rem;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 2px 20px #3a006f2e;
    padding: 1rem 2rem;
    display: flex;
    gap: 20px;
  }
  .subtitulo-container {
    border: 2px solid #6a0dad;
    border-radius: 16px;
    padding: 1rem 1.3rem;
    width: 300px;
    max-height: 600px;
    overflow-y: auto;
    background: #f2eeff;
    font-weight: 600;
    font-size: 1rem;
    color: #3a006f;
  }
  .subtitulo-container h3 {
    margin: 0 0 12px 0;
    font-weight: 800;
    color: #6a0dad;
    font-size: 1.3rem;
    border-bottom: 2px solid #6a0dad;
    padding-bottom: 6px;
    user-select: none;
  }
  .subtitulo-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .subtitulo-list li {
    padding: 0.55rem 0.8rem;
    margin-bottom: 5px;
    cursor: pointer;
    border-radius: 12px;
    transition: background-color 0.28s ease, color 0.28s ease;
  }
  .subtitulo-list li:hover, .subtitulo-list li.selected {
    background-color: #6a0dad;
    color: white;
    font-weight: 700;
  }
  .accion-container {
    flex-grow: 1;
    background: #fcfbfd;
    min-height: 180px;
    font-weight: 600;
    font-size: 1.12rem;
    color: #4a037d;
    border: 2px solid #6a0dad;
    border-radius: 16px;
    padding: 1rem 1.3rem;
    min-width: 460px;
    max-width: 600px;
    position: relative;
    display: flex;
    flex-direction: column;
  }
  .accion-container h3 {
    font-weight: 900;
    font-size: 1.5rem;
    color: #6a0dad;
    margin-bottom: 12px;
  }
  .accion-text {
    white-space: pre-line;
    padding-left: 1rem;
    flex-grow: 1;
  }

  /* Noticias sección */
  #noticiaRegion {
    margin-top: 16px;
    border-top: 2px solid #6a0dadaa;
    padding-top: 10px;
    max-height: 200px;
    overflow-y: auto;
  }
  #noticiaRegion h4 {
    margin: 0 0 10px 0;
    color: #52006b;
    font-weight: 900;
    font-size: 1.15rem;
  }
  #noticiaRegion img {
    max-width: 100%;
    border-radius: 12px;
    margin-bottom: 8px;
  }
  #noticiaRegion p {
    margin: 0.3rem 0;
    font-size: 1rem;
    color: #3a006fdd;
  }
  #noticiaRegion a {
    color: #6a0dad;
    font-weight: 700;
    text-decoration: none;
  }
  #noticiaRegion a:hover {
    text-decoration: underline;
  }

  /* Animaciones iconos clima */
  .icono-sun {
    animation: rotar 30s linear infinite;
  }
  .icono-cloud {
    animation: floatCloud 6s ease-in-out infinite;
  }
  .icono-rain {
    position: relative;
  }
  .icono-rain::after {
    content: "";
    position: absolute;
    left: 50%;
    width: 3px;
    height: 12px;
    background: #3a006fcc;
    border-radius: 50%;
    filter: blur(0.8px);
    animation: caerLluvia 1.2s linear infinite;
    animation-delay: 0s;
    top: 6px;
  }
  @keyframes rotar {
    0% { transform: rotate(0turn);}
    100% { transform: rotate(1turn);}
  }
  @keyframes floatCloud {
    0%, 100% { transform: translateY(0);}
    50% {transform: translateY(6px);}
  }
  @keyframes caerLluvia {
    0% {opacity: 1; transform: translateY(0);}
    100% {opacity: 0; transform: translateY(12px);}
  }
  @media (max-width: 900px) {
    main {
      flex-direction: column;
      padding: 1rem 1rem 3rem 1rem;
    }
    #panelClima {
      position: static;
      width: 100%;
      margin: 0 auto 1rem;
    }
    #perfilSeleccionado {
      position: static;
      max-width: 100%;
      margin: 1rem auto 1rem auto;
      box-shadow: none;
    }
    .accion-container {
      max-width: 100%;
      min-width: auto;
    }
  }
</style>
</head>
<body>
<header>
  Guía de pasos para SAGCOM 2
  <div class="autor-text" aria-label="Autor del documento">Creado por Héctor Alfaro M.</div>
</header>

<div id="panelClima" aria-label="Panel clima e información actual">
  <header>Clima y Hora</header>
  <div id="horaActual" aria-live="polite" aria-atomic="true">--:--:--</div>
  <select id="selectorRegion" aria-label="Seleccionar región de Chile para ver clima">
    <option value="" disabled selected>Seleccione región</option>
    <option value="Arica">Arica</option>
    <option value="Iquique">Iquique</option>
    <option value="Antofagasta">Antofagasta</option>
    <option value="Copiapo">Copiapó</option>
    <option value="La Serena">La Serena</option>
    <option value="Los Andes">Los Andes</option>
    <option value="Viña del Mar">Viña del Mar</option>
    <option value="Casa Matriz">Casa Matriz (Santiago)</option>
    <option value="Rancagua">Rancagua</option>
    <option value="Talca">Talca</option>
    <option value="Chillan">Chillán</option>
    <option value="Concepcion">Concepción</option>
    <option value="Lo Angeles">Lo Angeles</option>
    <option value="Temuco">Temuco</option>
    <option value="Valdivia">Valdivia</option>
    <option value="Osorno">Osorno</option>
    <option value="Puerto Montt">Puerto Montt</option>
    <option value="Chiloe">Chiloé</option>
    <option value="Coyhaique">Coyhaique</option>
    <option value="Punta Arenas">Punta Arenas</option>
  </select>
  <div id="climaInfo" aria-live="polite" role="region" style="margin-top:6px;">
    <div id="climaIcon" aria-label="Icono clima" role="img" style="font-size:2.8rem;"></div>
    <div>
      <div id="climaTemp">-- °C</div>
      <div id="climaText">Elija una región para ver el clima</div>
    </div>
  </div>
</div>

<div class="perfil-filter" id="perfilFilter" aria-label="Filtros por perfiles"></div>

<div class="filters">
  <input type="search" id="searchInput" placeholder="Filtrar texto/acción..." aria-label="Filtrar acciones" />
  <button id="btnReset" title="Borrar filtros">Borrar filtros</button>
  <button id="btnWebSearch" title="Buscar en sitio web oficial">Buscar en spensiones.cl</button>
</div>

<div id="perfilSeleccionado" aria-live="polite">Seleccione un perfil</div>

<main>
  <div class="subtitulo-container" aria-label="Tareas de perfil seleccionado">
    <h3>Tareas</h3>
    <nav class="subtitulo-list" id="subtituloList"><ul></ul></nav>
  </div>
  <div class="accion-container" aria-label="Acción a realizar para subtitulo">
    <h3>Acción a realizar</h3>
    <div class="accion-text" id="accionDisplay" tabindex="0" aria-live="polite"></div>

    <div id="noticiaRegion" aria-live="polite" aria-atomic="true">
      <h4>Noticias recientes</h4>
      <img id="imgNoticia" alt="Imagen noticia" src="" />
      <p id="textoNoticia">Seleccione una región para mostrar noticias relevantes.</p>
      <p><a id="linkNoticia" href="#" target="_blank" rel="noopener noreferrer">Leer noticia</a></p>
    </div>
  </div>
</main>

<script>
  const iconosAnim = {
    "☀️": "icono-sun",
    "⛅": "icono-cloud",
    "🌧️": "icono-rain",
    "🌫️": "icono-cloud",
    "☁️": "icono-cloud"
  };

  const noticiasPorRegion = {
    "Osorno": {
      titulo: "Alerta: Actividad volcánica en Volcán Osorno",
      imagen: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d1/Volcan_Osorno_Vista_desde_Laguna_Torrez.JPG/320px-Volcan_Osorno_Vista_desde_Laguna_Torrez.JPG",
      texto: "El Volcán Osorno ha mostrado actividad reciente, aconsejando precaución a las comunidades cercanas.",
      enlace: "https://www.onemi.cl/noticia/alerta-volcan-osorno/"
    },
    "Santiago": {
      titulo: "Santiago registra nuevas medidas para reducción de emisiones",
      imagen: "https://upload.wikimedia.org/wikipedia/commons/thumb/6/63/Santiago_de_Chile_desde_la_Alameda_January_2016.jpg/320px-Santiago_de_Chile_desde_la_Alameda_January_2016.jpg",
      texto: "El gobierno implementa medidas para mejorar la calidad del aire en Santiago.",
      enlace: "https://www.gob.cl/noticias/mejoras-calidad-aire-santiago/"
    },
    "Arica": {
      titulo: "Nuevo proyecto turístico impulsa Arica",
      imagen: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/df/Arica_y_Parinacota.svg/320px-Arica_y_Parinacota.svg.png",
      texto: "Arica está desarrollando nuevas iniciativas para fomentar el turismo sostenible.",
      enlace: "https://www.sernatur.cl/arica-y-parinacota/"
    },
    "Antofagasta": {
      titulo: "Antofagasta avanza en energía renovable",
      imagen: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e3/Antofagasta_Connect.jpg/320px-Antofagasta_Connect.jpg",
      texto: "La región apuesta por energías limpias aumentando su capacidad solar y eólica.",
      enlace: "https://www.gob.cl/noticias/energia-renovable-antofagasta/"
    }
  };

  function actualizarHora() {
    setInterval(() => {
      const ahora = new Date();
      const h = ahora.getHours().toString().padStart(2, "0");
      const m = ahora.getMinutes().toString().padStart(2, "0");
      const s = ahora.getSeconds().toString().padStart(2, "0");
      document.getElementById("horaActual").textContent = `${h}:${m}:${s}`;
    }, 1000);
  }

  function mostrarNoticia(region) {
    const noticia = noticiasPorRegion[region];
    const contenedor = document.getElementById("noticiaRegion");
    const img = document.getElementById("imgNoticia");
    const texto = document.getElementById("textoNoticia");
    const link = document.getElementById("linkNoticia");

    if(noticia){
      contenedor.querySelector("h4").textContent = noticia.titulo;
      img.src = noticia.imagen;
      img.alt = noticia.titulo;
      texto.textContent = noticia.texto;
      link.href = noticia.enlace;
      link.textContent = "Leer noticia";
      link.style.display = "inline";
      img.style.display = "block";
    } else {
      contenedor.querySelector("h4").textContent = "Noticias recientes";
      img.style.display = "none";
      texto.textContent = "No se encontraron noticias para esta región.";
      link.style.display = "none";
    }
  }

  function actualizarPanelClima(region) {
    const climaIcon = document.getElementById("climaIcon");
    if(!region){
      climaIcon.className = "";
      climaIcon.textContent = "";
      document.getElementById("climaTemp").textContent = "-- °C";
      document.getElementById("climaText").textContent = "Elija una región para ver el clima";
      return;
    }
    const condicionesDemostrativas = [
      {icon:"☀️", temp:23, texto:"Soleado", clase:"icono-sun"},
      {icon:"⛅", temp:18, texto:"Parcialmente nublado", clase:"icono-cloud"},
      {icon:"🌧️", temp:14, texto:"Lluvia ligera", clase:"icono-rain"},
      {icon:"🌫️", temp:12, texto:"Niebla", clase:"icono-cloud"},
      {icon:"☁️", temp:15, texto:"Nublado", clase:"icono-cloud"}
    ];
    const seleccion = condicionesDemostrativas[Math.floor(Math.random()*condicionesDemostrativas.length)];
    climaIcon.className = seleccion.clase;
    climaIcon.textContent = seleccion.icon;
    document.getElementById("climaTemp").textContent = `${seleccion.temp} °C`;
    document.getElementById("climaText").textContent = `${region}: ${seleccion.texto}`;
  }


  document.addEventListener("DOMContentLoaded", () => {
    actualizarHora();

    const pasos = [
      {perfil: "ADMINISTRATIVO",subtitulo: "ANALISIS DE ADMISIBILIDAD",accion:"VER + / REGULAR / BUSCAR RUT / VER +"},
      {perfil: "ADMINISTRATIVO",subtitulo: "ADMISIBILIDAD DE LA SOLICITUD",accion:"ACEPTAR / CONFIRMAR"},
      {perfil: "MÉDICO PRESIDENTE",subtitulo: "ASIGNAR MEDICO",accion:"REGULAR / BUSCAR RUT"},
      {perfil: "MÉDICO PRESIDENTE",subtitulo: "ACCIONES / AUTOASIGNAR Y/O MODIFICAR",accion:""},
      {perfil: "MÉDICO PRESIDENTE",subtitulo: "MARCAR MÉDICO / CONFIRMAR MÉDICO",accion:""},
      {perfil: "ADMINISTRATIVO",subtitulo: "INICIO / CITACIONES",accion:"VER + / REGULAR / BUSCAR RUT"},
      {perfil: "ADMINISTRATIVO",subtitulo: "ACCIONES / REAGENDAR 1 O 2 SOLICITUDES",accion:"(DEPENDE EL CASO)"},
      {perfil: "ADMINISTRATIVO",subtitulo: "GESTIONAR CITACION / PREVISUALIZAR CARTA",accion:"CONFIRMAR CITA"},
      {perfil: "ADMINISTRATIVO",subtitulo: "… NOMINA DE CORREO",accion:"MARCAR SOLICITUDES / ASIGNAR NÓMINA / CREAR"},
      {perfil: "ADMINISTRATIVO",subtitulo: "NÓMINA / EN GESTION",accion:"SE PINCHA LA 1ERA / REVISAR NOMINA"},
      {perfil: "ADMINISTRATIVO",subtitulo: "DESCARGAR DOCUMENTO NÓMINA",accion:""},
      {perfil: "ADMINISTRATIVO",subtitulo: "GUIA DE DESPACHO DE CORREOS",accion:"EDITAR No DE NÓMINA"},
      {perfil: "ADMINISTRATIVO",subtitulo: "DOCUMENTO GUIA DE DESPACHO",accion:"CAMBIAR FECHA (HOY) / ADJUNTAR NÓMINA / GUARDAR"},
      {perfil: "ADMINISTRATIVO",subtitulo: "INICIO",accion:"CONFIRMAR ASISTENCIA A EVALUACIONES"},
      {perfil: "ADMINISTRATIVO",subtitulo: "CONFIRMAR ASISTENCIA A EVALUACIONES",accion:"PRESENCIAL / TELEFONICA"},
      {perfil: "ADMINISTRATIVO",subtitulo: "BUSCAR C/ RUT / ACCIONES",accion:"SOBRECUPO / CAMBIAR HORA / CONFIRMAR / SI (X 2)"},
      {perfil: "ADMINISTRATIVO",subtitulo: "VER +",accion:"REGULAR / BUSCAR RUT / VER +"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "MIS EXPEDIENTES",accion:"EVALUACIÓN MÉDICA"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "PENDIENTE DE INICIO / EN EVALUACION",accion:"BUSCAR RUT / IR AL EXPEDIENTE"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "DESEA REALIZAR EVALUACION MEDICA?",accion:"COMENZAR"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "ANAMNESIS",accion:"COMPLETAR / GUARDAR"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "EXAMEN FÍSICO",accion:"COMPLETAR / GUARDAR"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "PLAN DE ACCIÓN",accion:"ACCIÓN A SEGUIR / PERITAJES Y/O EXAMENES"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "NUEVA SOLICITUD",accion:""},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "SOLICITAR INTERCONSULTAS",accion:"ESPECIALIDADES (…..) SELECCIONAR"},
      {perfil: "MÉDICO ASIGNADO",subtitulo: "SOLICITAR EXAMENES",accion:"EXAMENES DE LABORATORIO / FILTRAR / CONFIRMAR"},
      {perfil: "ADMINISTRATIVO",subtitulo: "ORDENES DE ATENCIÓN POR GESTIONAR",accion:"VER + / REGULAR / BUSCAR RUT"},
      {perfil: "ADMINISTRATIVO",subtitulo: "GESTIONAR ORDEN",accion:"SELECCIONAR COMISION / PROPUESTA DE SISTEMA N° 1"},
      {perfil: "ADMINISTRATIVO",subtitulo: "LABORATORIO VERIS",accion:""},
      {perfil: "ADMINISTRATIVO",subtitulo: "INTERCONSULTA SOLICITADA",accion:"COMPLETAR / ACCIONES / MODALIDAD DE ATENCION"},
      {perfil: "ADMINISTRATIVO",subtitulo: "CAMBIAR FECHA / HORA",accion:""},
      {perfil: "ADMINISTRATIVO",subtitulo: "SELECCIONAR INTERCONSULTOR (POR DEFECTO)",accion:""},
      {perfil: "ADMINISTRATIVO",subtitulo: "AGENDAR / CONFIRMAR / EMITIR ORDENES",accion:""},
      {perfil: "MÉDICO INTERCONSULTOR",subtitulo: "...ÓRDENES DE ATENCIÓN",accion:""},
      {perfil: "MÉDICO INTERCONSULTOR",subtitulo: "ÓRDENES EMITIDAS",accion:"FILTRAR CON RUT / SELECCIONAR, CONFIRMAR"},
      {perfil: "MÉDICO INTERCONSULTOR",subtitulo: "CONFIRMAR C/RUT/ INDICAR HORA / ACEPTAR",accion:""},
      {perfil: "MÉDICO INTERCONSULTOR",subtitulo: "ORDENES CONFIRMADAS",accion:"SELECCIONAR / REALIZAR EVALUACIÓN"},
      {perfil: "MÉDICO INTERCONSULTOR",subtitulo: "ADJUNTAR INFORME FINAL / ENVÍAR A REVISIÓN",accion:""},
      {perfil: "LABORATORIO",subtitulo: "ÓRDENES EMITIDAS",accion:"FILTRAR CON RUT / SELECCIONAR, CONFIRMAR"},
      {perfil: "LABORATORIO",subtitulo: "CONFIRMAR C/RUT/ INDICAR HORA / ACEPTAR",accion:""},
      {perfil: "LABORATORIO",subtitulo: "ÓRDENES CONFIRMADAS",accion:"SELECCIONAR / REALIZAR EVALUACIÓN"},
      {perfil: "LABORATORIO",subtitulo: "DOCUMENTOS DE PRESTACIONES",accion:"ADJUNTAR / ACEPTAR / ENVÍAR A REVISIÓN / ACEPTAR"},
      {perfil: "ADMINISTRATIVO",subtitulo: "ÓRDENES DE ATENCIÓN",accion:"ORDENES DE ATENCIÓN TRABAJADAS"},
      {perfil: "ADMINISTRATIVO",subtitulo: "EN VERIFICACIÓN DE RECEPCIÓN",accion:"ACCIONES /VALIDAR PARA COBRO / ACEPTAR"},
      {perfil: "MÉDICO INTERCONSULTOR",subtitulo: "ORDENES VALIDADAS PARA COBRO",accion:"FILTRAR C/ RUT / SELECCIONAR / COBRAR"},
      {perfil: "MÉDICO ASESOR",subtitulo: "MI TRABAJO",accion:"EVALUACIÓN MEDICA"},
      {perfil: "MÉDICO ASESOR",subtitulo: "PENDIENTE INICIO / EN EVALUACIÓN",accion:"FILTRAR C/RUT / IR AL EXPEDIENTE"},
      {perfil: "MÉDICO ASESOR",subtitulo: "GESTIÓN DEL EXPEDIENTE",accion:""},
      {perfil: "MÉDICO ASESOR",subtitulo: "DESEA REALIZAR ENTREVISTA MEDICA?",accion:"COMENZAR / ENTREVISTA CON MEDICO ASESOR"},
      {perfil: "MÉDICO ASESOR",subtitulo: "REALIZAR LA ENTREVISTATELEFONICA? / SI",accion:"COMENZAR"},
      {perfil: "MÉDICO ASESOR",subtitulo: "COMPLETAR IMPEDIMENTOS / AGREGAR",accion:""},
      {perfil: "MÉDICO ASESOR",subtitulo: "COMPLETAR TRATAMIENTO / AGREGAR",accion:""},
      {perfil: "MÉDICO ASESOR",subtitulo: "SOLICITUD INFUNDADA",accion:"SI, SI, SI , A LAS PREGUNTAS."},
      {perfil: "MÉDICO ASESOR",subtitulo: "FINALIZAR / GENERAR PDF",accion:""}
    ];

    function unificarPerfil(p) {
      const pf = p.toLowerCase();
      if(pf.includes("medico presidente")) return "Médico Presidente";
      if(pf.includes("medico asignado")) return "Médico Asignado";
      if(pf.includes("medico interconsultor")) return "Médico Interconsultor";
      if(pf.includes("medico asesor")) return "Médico Asesor";
      if(pf.includes("medico designado")) return "Médico Designado";
      if(pf.includes("administrativo")) return "Administrativo";
      return p;
    }

    const perfilMap = {};
    pasos.forEach(p => {
      const pUni = unificarPerfil(p.perfil);
      if(!perfilMap[pUni]) perfilMap[pUni] = [];
      if(!perfilMap[pUni].includes(p.perfil)) perfilMap[pUni].push(p.perfil);
    });

    const perfilFilterDiv = document.getElementById("perfilFilter");
    const subtituloListUl = document.getElementById("subtituloList").querySelector("ul");
    const accionDisplay = document.getElementById("accionDisplay");
    const searchInput = document.getElementById("searchInput");
    const btnReset = document.getElementById("btnReset");
    const btnWebSearch = document.getElementById("btnWebSearch");
    const perfilSeleccionadoDiv = document.getElementById("perfilSeleccionado");
    const selectorRegion = document.getElementById("selectorRegion");
    const climaIcon = document.getElementById("climaIcon");
    const climaTemp = document.getElementById("climaTemp");
    const climaText = document.getElementById("climaText");
    const noticiaRegion = document.getElementById("noticiaRegion");
    const imgNoticia = document.getElementById("imgNoticia");
    const textoNoticia = document.getElementById("textoNoticia");
    const linkNoticia = document.getElementById("linkNoticia");

    let perfilActual = null;

    function limpiarSeleccion() {
      accionDisplay.textContent = "";
      subtituloListUl.querySelectorAll("li").forEach(li => li.classList.remove("selected"));
    }

    function mostrarNoticia(region) {
      const noticia = noticiasPorRegion[region];
      if(noticia){
        noticiaRegion.querySelector("h4").textContent = noticia.titulo;
        imgNoticia.src = noticia.imagen;
        imgNoticia.alt = noticia.titulo;
        textoNoticia.textContent = noticia.texto;
        linkNoticia.href = noticia.enlace;
        linkNoticia.textContent = "Leer noticia";
        linkNoticia.style.display = "inline";
        imgNoticia.style.display = "block";
      } else {
        noticiaRegion.querySelector("h4").textContent = "Noticias recientes";
        imgNoticia.style.display = "none";
        textoNoticia.textContent = "No se encontraron noticias para esta región.";
        linkNoticia.style.display = "none";
      }
    }

    function actualizarPanelClima(region) {
      if(!region){
        climaIcon.className = "";
        climaIcon.textContent = "";
        climaTemp.textContent = "-- °C";
        climaText.textContent = "Elija una región para ver el clima";
        mostrarNoticia(null);
        return;
      }
      const condicionesDemostrativas = [
        {icon:"☀️", temp:23, texto:"Soleado", clase:"icono-sun"},
        {icon:"⛅", temp:18, texto:"Parcialmente nublado", clase:"icono-cloud"},
        {icon:"🌧️", temp:14, texto:"Lluvia ligera", clase:"icono-rain"},
        {icon:"🌫️", temp:12, texto:"Niebla", clase:"icono-cloud"},
        {icon:"☁️", temp:15, texto:"Nublado", clase:"icono-cloud"}
      ];
      const seleccion = condicionesDemostrativas[Math.floor(Math.random()*condicionesDemostrativas.length)];
      climaIcon.className = seleccion.clase;
      climaIcon.textContent = seleccion.icon;
      climaTemp.textContent = `${seleccion.temp} °C`;
      climaText.textContent = `${region}: ${seleccion.texto}`;

      mostrarNoticia(region);
    }

    function cargarSubtitulos(arrayPerfiles) {
      subtituloListUl.innerHTML = "";
      if(!arrayPerfiles || arrayPerfiles.length === 0)
        return;

      let subtitulosSet = new Set();
      arrayPerfiles.forEach(po => {
        pasos.filter(p => p.perfil === po).forEach(p => {
          subtitulosSet.add(p.subtitulo);
        });
      });

      let subtitulosArr = Array.from(subtitulosSet).sort();

      const filtro = searchInput.value.trim().toLowerCase();
      if(filtro) {
        subtitulosArr = subtitulosArr.filter(s => {
          return arrayPerfiles.some(po =>
            pasos.some(p => p.perfil === po && p.subtitulo === s &&
              (p.subtitulo + p.accion).toLowerCase().includes(filtro)));
        });
      }
      if(!perfilActual && filtro) {
        let globalSet = new Set();
        pasos.forEach(p => {
          if((p.subtitulo + p.accion).toLowerCase().includes(filtro))
            globalSet.add(p.subtitulo);
        });
        subtitulosArr = Array.from(globalSet).sort();
      }

      if(subtitulosArr.length === 0) {
        subtituloListUl.innerHTML = '<li style="text-align:center;color:#6a0dad;">No hay tareas</li>';
        accionDisplay.textContent = "";
        return;
      }
      subtitulosArr.forEach(subt => {
        const li = document.createElement("li");
        li.textContent = subt;
        li.tabIndex = 0;
        li.setAttribute("role", "button");
        li.setAttribute("aria-pressed", "false");
        li.onclick = () => seleccionarSubtitulo(subt, li, arrayPerfiles);
        li.onkeydown = e => {
          if(e.key === "Enter" || e.key === " ") {
            seleccionarSubtitulo(subt, li, arrayPerfiles);
            e.preventDefault();
          }
        };
        subtituloListUl.appendChild(li);
      });
      limpiarSeleccion();
    }

    function seleccionarSubtitulo(subtitulo, liElem, arrayPerfiles) {
      subtituloListUl.querySelectorAll("li").forEach(li => li.classList.remove("selected"));
      liElem.classList.add("selected");

      let acciones = [];
      if(perfilActual) {
        arrayPerfiles.forEach(pf => {
          acciones = acciones.concat(pasos.filter(p => p.perfil === pf && p.subtitulo === subtitulo)
              .map(p => p.accion).filter(a => a && a.trim() !== ""));
        });
      } else {
        acciones = pasos.filter(p => p.subtitulo === subtitulo).map(p => p.accion)
            .filter(a => a && a.trim() !== "");
      }
      acciones = [...new Set(acciones)];
      if(acciones.length === 0) {
        accionDisplay.textContent = "Sin acciones asociadas.";
      } else {
        accionDisplay.innerHTML = acciones.map(a=>`• ${a}`).join("\n");
      }
      accionDisplay.focus();
    }

    actualizarHora();

    Object.keys(perfilMap).forEach(perfUni => {
      const btn = document.createElement("button");
      btn.className = "perfil-btn";
      btn.textContent = perfUni;
      btn.dataset.perfil = perfUni;
      btn.onclick = () => {
        if(perfilActual === perfUni) {
          perfilActual = null;
          btn.classList.remove("active");
          perfilSeleccionadoDiv.textContent = "Seleccione un perfil";
          cargarSubtitulos([]);
          limpiarSeleccion();
        } else {
          perfilActual = perfUni;
          document.querySelectorAll(".perfil-btn").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          perfilSeleccionadoDiv.textContent = perfUni;
          cargarSubtitulos(perfilMap[perfUni]);
          limpiarSeleccion();
        }
      };
      perfilFilterDiv.appendChild(btn);
    });

    btnReset.onclick = () => {
      perfilActual = null;
      limpiarSeleccion();
      perfilSeleccionadoDiv.textContent = "Seleccione un perfil";
      subtituloListUl.innerHTML = "";
      accionDisplay.textContent = "";
      searchInput.value = "";
      document.querySelectorAll(".perfil-btn").forEach(b => b.classList.remove("active"));
      mostrarNoticia(null);
      actualizarPanelClima(null);
    };

    searchInput.addEventListener("input", () => {
      if(perfilActual)
        cargarSubtitulos(perfilMap[perfilActual]);
      else
        cargarSubtitulos([]);
      limpiarSeleccion();
    });

    btnWebSearch.onclick = () => {
      window.open("https://www.spensiones.cl/portal/compendio/596/w3-propertyvalue-3208.html", "_blank");
    };

    selectorRegion.addEventListener("change", e => {
      actualizarPanelClima(e.target.value);
    });
  });
</script>
</body>
</html>
