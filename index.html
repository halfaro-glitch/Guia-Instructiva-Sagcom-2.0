<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<title>Guía SAGCOM 2 - Completo con Imágenes y Zoom</title>
<style>
  body::before {
    content: "";
    position: fixed; top:0; left:0; right:0; bottom:0;
    background: url('https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/refs/heads/main/imagen.avif') no-repeat center center fixed;
    background-size: contain;
    filter: brightness(0.95);
    z-index: -3;
  }
  body::after {
    content: "";
    position: fixed; top:0; left:0; right:0; bottom:0;
    background: linear-gradient(135deg,
    rgba(255,255,255,0.15) 10%,
    rgba(255,255,255,0.45) 30%,
    rgba(255,255,255,0.15) 70%,
    rgba(255,255,255,0.05) 90%);
    pointer-events:none;
    z-index:-2;
  }
  body {
    font-family: Arial,sans-serif;
    margin: 0; padding: 0 0 4rem 0;
    background: #fff;
    color: #222;
    position: relative;
  }
  header {
    background: linear-gradient(145deg, #3a006f 0%, #6a0dad 60%, #fff 100%);
    color: #fff;
    font-weight: bold;
    font-size:2rem;
    text-align:center;
    padding: 2rem 1rem 3rem 1rem;
    letter-spacing: 1px;
    text-shadow: 3px 3px 8px #00000088;
    position: relative;
  }
  header .autor-text {
    position: absolute;
    bottom: 1rem;
    right: 1rem;
    color: rgba(255,255,255,0.9);
    font-family: Georgia, serif;
    font-weight: 700;
    font-size: 1.1rem;
    user-select:none;
  }
  #perfilSeleccionado {
    position: fixed;
    top: 12px;
    left: 12px;
    background: linear-gradient(145deg, #fdf6ff, #bb9edc);
    border-radius: 16px;
    padding: 6px 14px;
    font-size: 1rem;
    font-weight: 700;
    color: #6a0dad;
    text-align: center;
    box-shadow: 0 8px 20px #7854ebaa,
    inset 0 -3px 10px #a095d1a1,
    inset 0 6px 8px #7b65c89a;
    user-select:none;
    max-width: 320px;
    z-index: 101;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .perfil-filter {
    display:flex;
    justify-content: center;
    gap:1rem;
    flex-wrap: wrap;
    margin: 1.5rem auto 1rem;
    max-width:1100px;
  }
  .perfil-btn {
    background: linear-gradient(145deg, #6a0dad 0%, #3a006f 90%);
    border-radius: 24px;
    padding: 0.5rem 1.8rem;
    font-size: 1rem;
    font-weight: 700;
    color: white;
    border: none;
    cursor:pointer;
    box-shadow: 0 4px 16px #3a006f77;
    transition: transform 0.28s ease, box-shadow 0.28s ease, background-color 0.3s ease;
    text-shadow: 1px 1px 8px #000000cc;
    white-space: nowrap;
  }
  .perfil-btn:hover {
    box-shadow: 0 8px 24px #6a0daddd;
    transform: scale(1.1);
  }
  .perfil-btn.active {
    background-color: #52006b;
    box-shadow: 0 10px 28px #6a0dadcc;
    transform: scale(1.15);
  }
  .filters {
    max-width: 1100px;
    margin: 0.8rem auto 2rem auto;
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    align-items: center;
  }
  .filters input[type=search] {
    border:2px solid #6a0dad;
    border-radius: 10px;
    padding: 0.45rem 1.25rem;
    font-size: 1rem;
    outline:none;
    box-shadow: 0 1px 7px #3a006f21;
    transition: 0.3s box-shadow ease;
    min-width: 350px;
  }
  .filters input[type=search]:focus {
    box-shadow: 0 0 13px #6a0dad77;
    border-color: #3a006f;
  }
  .filters button {
    font-weight: 700;
    padding: 0.4rem 1.1rem;
    border-radius: 12px;
    border: none;
    font-size: 1rem;
    cursor:pointer;
    color:white;
    box-shadow: 0 3px 20px #3a006fcc;
    transition: 0.3s background-color ease;
  }
  #btnReset {
    background-color: #a010d3;
  }
  #btnReset:hover {
    background-color: #68009a;
  }
  #btnWebSearch {
    background-color: #3d84e6;
  }
  #btnWebSearch:hover {
    background-color: #245ea7;
  }
  #btnSagcom {
    background-color: #228B22;
  }
  #btnSagcom:hover {
    background-color: #176417;
  }
  main {
    max-width: 1100px;
    margin: 0 auto 4rem;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 2px 20px #3a006f2e;
    padding: 1rem 2rem;
    display: flex;
    gap: 20px;
  }
  .subtitulo-container {
    border: 2px solid #6a0dad;
    border-radius: 16px;
    padding: 1rem 1.3rem;
    width: 350px;
    max-height: 600px;
    overflow-y: auto;
    background: #f2eeff;
    font-weight: 600;
    font-size: 1rem;
    color: #3a006f;
  }
  .subtitulo-container h3 {
    margin: 0 0 12px 0;
    font-weight: 800;
    color: #6a0dad;
    font-size: 1.3rem;
    border-bottom: 2px solid #6a0dad;
    padding-bottom: 6px;
    user-select: none;
  }
  .subtitulo-list ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .subtitulo-list li {
    padding: 0.55rem 0.8rem;
    margin-bottom: 5px;
    cursor: pointer;
    border-radius: 12px;
    transition: background-color 0.28s ease, color 0.28s ease;
  }
  .subtitulo-list li:hover, .subtitulo-list li.selected {
    background-color: #6a0dad;
    color: white;
    font-weight: 700;
  }
  .accion-container {
    flex-grow: 1;
    background: #fcfbfd;
    min-height: 180px;
    font-weight: 600;
    font-size: 1.12rem;
    color: #4a037d;
    border: 2px solid #6a0dad;
    border-radius: 16px;
    padding: 1rem 1.3rem;
    min-width: 460px;
    max-width: 600px;
    position: relative;
  }
  .accion-container h3 {
    font-weight: 900;
    font-size: 1.5rem;
    color: #6a0dad;
    margin-bottom: 12px;
  }
  .accion-text {
    white-space: pre-wrap;
    padding-left: 1rem;
  }
  .accion-image {
    max-width: 100%;
    height: auto;
    display: block;
    margin-top: 12px;
    border-radius: 12px;
    box-shadow: 0 3px 8px rgb(106 13 173 / 0.7);
    cursor:pointer;
    transition: transform 0.3s ease;
  }
  .accion-image:hover {
    transform: scale(1.03);
  }
  /* Modal zoom */
  .modal {
    display: none;
    position: fixed;
    z-index: 105;
    padding-top: 60px;
    left: 0; top: 0;
    width: 100%; height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.8);
    user-select:none;
  }
  .modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 80%;
    border-radius: 12px;
  }
  .modal-close {
    position: fixed;
    top: 20px;
    right: 40px;
    color: white;
    font-size: 36px;
    font-weight: bold;
    cursor:pointer;
    user-select:none;
  }
  .modal-close:hover {
    color: #bbb;
  }
  @media(max-width:900px){
    main {
      flex-direction: column;
      padding: 1rem;
    }
    .subtitulo-container, .accion-container {
      max-width: 100%;
      width: 100%;
      min-width: auto;
    }
    #perfilSeleccionado {
      position: relative;
      top: auto; left: auto;
      margin: 0 auto 1rem auto;
      max-width: 100%;
      white-space: normal;
    }
  }
</style>
</head>
<body>
<header>
  Guía de pasos para SAGCOM 2
  <div class="autor-text" aria-label="Autor del documento">Creado por Héctor Alfaro y Javier Zuñiga.</div>
</header>

<div id="perfilSeleccionado" aria-live="polite" aria-atomic="true">Seleccione un perfil</div>

<div class="perfil-filter" id="perfilFilter" aria-label="Filtros por perfiles"></div>

<div class="filters">
  <input type="search" id="searchInput" placeholder="Filtrar toda la guía..." aria-label="Filtro global de búsqueda" />
  <button id="btnReset" title="Borrar filtros">Borrar filtros</button>
  <button id="btnWebSearch" title="Buscar en pensiones.cl">Buscar en pensiones.cl</button>
  <button id="btnSagcom" title="Ir al sitio SAGCOM">SAGCOM</button>
</div>

<main>
  <div class="subtitulo-container" aria-label="Tareas de perfil seleccionado">
    <h3>Tareas</h3>
    <nav class="subtitulo-list" id="subtituloList"><ul></ul></nav>
  </div>
  <div class="accion-container" aria-label="Acción a realizar para subtitulo">
    <h3>Acción a realizar</h3>
    <div class="accion-text" id="accionDisplay" tabindex="0"></div>
  </div>
</main>

<!-- Modal para zoom de imagen -->
<div id="imgModal" class="modal" aria-hidden="true" role="dialog" aria-label="Imagen ampliada">
  <span class="modal-close" id="modalClose" role="button" tabindex="0" aria-label="Cerrar imagen ampliada">&times;</span>
  <img class="modal-content" id="modalImage" alt="Imagen ampliada paso a paso">
</div>

<script>
  document.addEventListener("DOMContentLoaded", ()=>{
    const pasos = [
      {perfil:"ADMINISTRATIVO", subtitulo:"ANALISIS DE ADMISIBILIDAD", accion:"VER + / REGULAR / BUSCAR RUT / VER +", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"ADMISIBILIDAD DE LA SOLICITUD", accion:"ACEPTAR / CONFIRMAR", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"INICIO / CITACIONES", accion:"VER + / REGULAR / BUSCAR RUT / ACCIONES / REAGENDAR 1 O 2 SOLICITUDES (DEPENDE EL CASO)", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"GESTIONAR CITACION / PREVISUALIZAR CARTA", accion:"CONFIRMAR CITA", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"NOMINA DE CORREO", accion:"MARCAR SOLICITUDES / ASIGNAR NÓMINA / CREAR / NÓMINA / EN GESTION / SE PINCHA LA 1ERA / REVISAR NOMINA / DESCARGAR DOCUMENTO NÓMINA", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"GUIA DE DESPACHO DE CORREOS", accion:"EDITAR No DE NÓMINA", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"DOCUMENTO GUIA DE DESPACHO", accion:"CAMBIAR FECHA (HOY) / ADJUNTAR NÓMINA / GUARDAR", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"INICIO", accion:"CONFIRMAR ASISTENCIA A EVALUACIONES PRESENCIAL / TELEFONICA / BUSCAR C/ RUT / ACCIONES / SOBRECUPO / CAMBIAR HORA / CONFIRMAR / SI (X 2)", inicial:"A"},
      {perfil:"MÉDICO PRESIDENTE", subtitulo:"ASIGNAR MEDICO", accion:"REGULAR / BUSCAR RUT", inicial:"M"},
      {perfil:"MÉDICO PRESIDENTE", subtitulo:"ACCIONES", accion:"AUTOASIGNAR Y/O MODIFICAR", inicial:"M"},
      {perfil:"MÉDICO PRESIDENTE", subtitulo:"MARCAR MÉDICO / CONFIRMAR MÉDICO", accion:"", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"MIS EXPEDIENTES", accion:"EVALUACIÓN MÉDICA", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"PENDIENTE DE INICIO / EN EVALUACION", accion:"BUSCAR RUT / IR AL EXPEDIENTE / DESEA REALIZAR EVALUACION MEDICA? / COMENZAR", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"ANAMNESIS", accion:"COMPLETAR / GUARDAR", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"EXAMEN FÍSICO", accion:"COMPLETAR / GUARDAR", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"PLAN DE ACCIÓN", accion:"ACCIÓN A SEGUIR / PERITAJES Y/O EXAMENES", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"NUEVA SOLICITUD", accion:"", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"SOLICITAR INTERCONSULTAS", accion:"ESPECIALIDADES (…..) SELECCIONAR", inicial:"M"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"SOLICITAR EXAMENES", accion:"EXAMENES DE LABORATORIO / FILTRAR / CONFIRMAR", inicial:"M"},
      {perfil:"ADMINISTRATIVO", subtitulo:"ORDENES DE ATENCIÓN POR GESTIONAR", accion:"VER + / REGULAR / BUSCAR RUT", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"GESTIONAR ORDEN", accion:"SELECCIONAR COMISION / PROPUESTA DE SISTEMA N° 1 / LABORATORIO VERIS", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"INTERCONSULTA SOLICITADA", accion:"COMPLETAR / ACCIONES / MODALIDAD DE ATENCION / CAMBIAR FECHA / HORA / SELECCIONAR INTERCONSULTOR (POR DEFECTO) / AGENDAR / CONFIRMAR / EMITIR ORDENES", inicial:"A"},
      {perfil:"MÉDICO INTERCONSULTOR", subtitulo:"ÓRDENES EMITIDAS", accion:"FILTRAR CON RUT / SELECCIONAR / CONFIRMAR / CONFIRMAR C/RUT/ INDICAR HORA / ACEPTAR", inicial:"M"},
      {perfil:"MÉDICO INTERCONSULTOR", subtitulo:"ORDENES CONFIRMADAS", accion:"SELECCIONAR / REALIZAR EVALUACIÓN / ADJUNTAR INFORME FINAL / ENVÍAR A REVISIÓN", inicial:"M"},
      {perfil:"LABORATORIO", subtitulo:"ÓRDENES EMITIDAS", accion:"FILTRAR CON RUT / SELECCIONAR / CONFIRMAR / CONFIRMAR C/RUT/ INDICAR HORA / ACEPTAR", inicial:"L"},
      {perfil:"LABORATORIO", subtitulo:"ÓRDENES CONFIRMADAS", accion:"SELECCIONAR / REALIZAR EVALUACIÓN", inicial:"L"},
      {perfil:"LABORATORIO", subtitulo:"DOCUMENTOS DE PRESTACIONES", accion:"ADJUNTAR / ACEPTAR / ENVÍAR A REVISIÓN / ACEPTAR", inicial:"L"},
      {perfil:"ADMINISTRATIVO", subtitulo:"ÓRDENES DE ATENCIÓN", accion:"ORDENES DE ATENCIÓN TRABAJADAS", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"EN VERIFICACIÓN DE RECEPCIÓN", accion:"ACCIONES /VALIDAR PARA COBRO / ACEPTAR", inicial:"A"},
      {perfil:"MÉDICO INTERCONSULTOR", subtitulo:"ORDENES VALIDADAS PARA COBRO", accion:"FILTRAR C/ RUT / SELECCIONAR / COBRAR / MISMOS PASOS CON PERFIL DE LABORATORIO", inicial:"M"},
      {perfil:"MÉDICO ASESOR", subtitulo:"MI TRABAJO", accion:"EVALUACIÓN MEDICA / PENDIENTE INICIO / EN EVALUACIÓN / FILTRAR C/RUT / IR AL EXPEDIENTE", inicial:"M"},
      {perfil:"MÉDICO ASESOR", subtitulo:"GESTIÓN DEL EXPEDIENTE", accion:"DESEA REALIZAR ENTREVISTA MEDICA? / COMENZAR / ENTREVISTA CON MEDICO ASESOR / REALIZAR LA ENTREVISTATELEFONICA? / SI / COMENZAR / COMPLETAR IMPEDIMENTOS / AGREGAR / COMPLETAR TRATAMIENTO / AGREGAR", inicial:"M"},
      {perfil:"MÉDICO ASESOR", subtitulo:"SOLICITUD INFUNDADA", accion:"SI, SI, SI , A LAS PREGUNTAS. / FINALIZAR / GENERAR PDF", inicial:"M"},
      {perfil:"ADMINISTRATIVO", subtitulo:"INICIO / REVISION DE GLOSAS", accion:"BUSCAR RUT / VERIFICAR GLOSA / VER + / PREVISUALIZAR DOCUMENTO / DESCARGAR / CONFIRMAR REGISTRO", inicial:"A"},
      {perfil:"MÉDICO ASIGNADO", subtitulo:"INICIO / FIRMA DE DOCUMENTOS", accion:"ACTA SESION / BUSCAR N° DE SESION / FIRMAR DOCUMENTO (CLAVE Pr01)", inicial:"M"},
      {perfil:"MÉDICO PRESIDENTE", subtitulo:"INICIO / FIRMA DE DOCUMENTOS", accion:"ACTA SESION / BUSCAR X N° DE SESION / FIRMAR DOCUMENTO (CLAVE Pr01)", inicial:"M"},
      {perfil:"MÉDICO ASESOR", subtitulo:"INICIO / FIRMA DE DOCUMENTOS", accion:"ACTA SESION / BUSCAR X N° DE SESION / FIRMAR DOCUMENTO (CLAVE Pr01)", inicial:"M"},
      {perfil:"ADMINISTRATIVO", subtitulo:"FIRMA DE DOCUMENTOS", accion:"VER + / DICTAMEN / BUSCAR No DE SESION / NOTIFICAR", inicial:"A"},
      {perfil:"MÉDICO DESIGNADO", subtitulo:"DICTAMEN", accion:"BUSCAR No DE SEION / FIRMAR DOCUMENTO", inicial:"M"},
      {perfil:"MÉDICO PRESIDENTE", subtitulo:"DICTAMEN", accion:"BUSCAR No DE SEION / FIRMAR DOCUMENTO", inicial:"M"},
      {perfil:"ADMINISTRATIVO", subtitulo:"NÓMINA DE CORREO", accion:"DICTAMENES MARCAR RUT / ASIGNAR NÓMINA / CREAR / DESCARGAR DOCUMENTO NÓMINA / GUIA DE DESPACHO DE CORREO VA N°DE NOMINA / DOCUMENTOS GUIA DE DESPACHO / COMPLETAR FECHA / ADJUNTAR DOCTO / GUARDAR", inicial:"A"},
      {perfil:"ADMINISTRATIVO", subtitulo:"MONITOREAR", accion:"ETAPA 9", inicial:"A"}
    ];

    const imagenesPorSubtitulo = {
      "ANALISIS DE ADMISIBILIDAD": [
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad.%201.jpg",
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%202%20.jpg",
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%203.jpg",
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%204%20.png",
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%205.jpg",
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%206.jpg"
      ],
      "ADMISIBILIDAD DE LA SOLICITUD": [
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad.%201.jpg",
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%202%20.jpg"
      ],
      "ADMISIBILIDAD RECHAZO": [
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%20Rechazo%201.jpg",
        "https://raw.githubusercontent.com/halfaro-glitch/Guia-Instructiva-Sagcom-2.0/main/Admisibilidad%20Rechazo%202%20.png"
      ]
    };

    let perfilActivo = null;
    let subtituloActivo = null;

    const perfilFilter = document.getElementById("perfilFilter");
    const perfilSeleccionado = document.getElementById("perfilSeleccionado");
    const subtituloList = document.getElementById("subtituloList").querySelector("ul");
    const accionDisplay = document.getElementById("accionDisplay");

    function cargarFiltros() {
      const perfilesUnicos = [...new Set(pasos.map(p => p.perfil))];
      perfilFilter.innerHTML = "";
      perfilesUnicos.forEach((perfil) => {
        const btn = document.createElement("button");
        btn.textContent = perfil;
        btn.classList.add("perfil-btn");
        btn.setAttribute("aria-pressed", "false");
        btn.addEventListener("click", () => {
          perfilActivo = perfil;
          cargarSubtitulos();
          actualizarPerfilSeleccionado();
          limpiarSeleccion();
        });
        perfilFilter.appendChild(btn);
      });
    }

    function actualizarPerfilSeleccionado() {
      perfilSeleccionado.textContent = perfilActivo
        ? `Perfil: ${perfilActivo}`
        : "Seleccione un perfil";
      [...perfilFilter.children].forEach((btn) => {
        btn.classList.toggle("active", btn.textContent === perfilActivo);
        btn.setAttribute(
          "aria-pressed",
          btn.textContent === perfilActivo ? "true" : "false"
        );
      });
    }

    function cargarSubtitulos() {
      subtituloList.innerHTML = "";
      if (!perfilActivo) return;
      const subtitulos = pasos.filter((p) => p.perfil === perfilActivo);
      subtitulos.forEach((sub) => {
        const li = document.createElement("li");
        li.textContent = `${sub.inicial} - ${sub.subtitulo}`;
        li.tabIndex = 0;
        li.addEventListener("click", () => {
          subtituloActivo = sub;
          mostrarAccion();
          destacarSeleccion(li);
        });
        li.addEventListener("keypress", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            subtituloActivo = sub;
            mostrarAccion();
            destacarSeleccion(li);
          }
        });
        subtituloList.appendChild(li);
      });
    }

    function destacarSeleccion(elemento) {
      [...subtituloList.children].forEach((li) =>
        li.classList.remove("selected")
      );
      elemento.classList.add("selected");
    }

    function mostrarAccion() {
      accionDisplay.innerHTML = "";
      if (!subtituloActivo) return;
      const texto = subtituloActivo.accion.replace(/\n/g,"<br/>");
      accionDisplay.innerHTML = `<div>${texto}</div>`;

      // Mostrar imagenes si existen para subtitulo
      if(imagenesPorSubtitulo[subtituloActivo.subtitulo]){
        imagenesPorSubtitulo[subtituloActivo.subtitulo].forEach(url=>{
          const img = document.createElement("img");
          img.src = url;
          img.alt = "Flujo paso a paso";
          img.classList.add("accion-image");
          img.tabIndex = 0;
          // al click, abrir modal imagen ampliada
          img.addEventListener("click", ()=>abrirModal(url));
          img.addEventListener("keypress", e => {
            if(e.key==="Enter" || e.key===" ") abrirModal(url);
          });
          accionDisplay.appendChild(img);
        });
      }
      accionDisplay.focus();
    }

    function limpiarSeleccion() {
      subtituloActivo = null;
      accionDisplay.textContent = "";
      [...subtituloList.children].forEach((li) =>
        li.classList.remove("selected")
      );
    }

    const searchInput = document.getElementById("searchInput");
    const btnReset = document.getElementById("btnReset");
    searchInput.addEventListener("input", () => {
      const query = searchInput.value.trim().toLowerCase();
      if (!perfilActivo) return;
      subtituloList.innerHTML = "";
      pasos
        .filter(
          (p) =>
            p.perfil === perfilActivo &&
            (p.subtitulo.toLowerCase().includes(query) ||
              p.accion.toLowerCase().includes(query))
        )
        .forEach((sub) => {
          const li = document.createElement("li");
          li.textContent = `${sub.inicial} - ${sub.subtitulo}`;
          li.tabIndex = 0;
          li.addEventListener("click", () => {
            subtituloActivo = sub;
            mostrarAccion();
            destacarSeleccion(li);
          });
          li.addEventListener("keypress", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              subtituloActivo = sub;
              mostrarAccion();
              destacarSeleccion(li);
            }
          });
          subtituloList.appendChild(li);
        });
      limpiarSeleccion();
    });

    btnReset.addEventListener("click", () => {
      searchInput.value = "";
      limpiarSeleccion();
      cargarSubtitulos();
    });

    const btnWebSearch = document.getElementById("btnWebSearch");
    btnWebSearch.addEventListener("click", () => {
      if (!perfilActivo) return;
      window.open("https://www.spensiones.cl/portal/compendio/596/w3-propertyvalue-3208.html", "_blank");
    });

    const btnSagcom = document.getElementById("btnSagcom");
    btnSagcom.addEventListener("click", () => {
      window.open("https://www.sagcom.cl/acceso?from=/monitoreo", "_blank");
    });

    // Modal funciones y evento
    const modal = document.getElementById("imgModal");
    const modalImg = document.getElementById("modalImage");
    const modalClose = document.getElementById("modalClose");

    function abrirModal(src){
      modal.style.display = "block";
      modal.setAttribute("aria-hidden", "false");
      modalImg.src = src;
      modalImg.alt = "Imagen ampliada paso a paso";
      modalClose.focus();
    }

    function cerrarModal(){
      modal.style.display = "none";
      modal.setAttribute("aria-hidden", "true");
      modalImg.src = "";
    }

    modalClose.addEventListener("click", cerrarModal);
    modalClose.addEventListener("keypress", e=>{
      if(e.key==="Enter"|| e.key===" ") cerrarModal();
    });
    modal.addEventListener("click", e=>{
      if(e.target===modal) cerrarModal();
    });

    cargarFiltros();
  });
</script>
</body>
</html>
